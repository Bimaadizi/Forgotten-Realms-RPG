<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>System Prompt Builder</title>
  <style>
    * { box-sizing: border-box; }
    body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: url('backgroundbuilder.png') no-repeat center center fixed;
  background-size: cover;
}

    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .builder, .modules {
      background: #fff;
      padding: 20px;
      border-radius: 0px;
    }
    .builder {
      flex: 2;
      min-width: 300px;
    }
    .modules {
      flex: 1;
      min-width: 250px;
      max-height: 90vh;
      overflow-y: auto;
    }
    textarea {
      width: 100%;
      height: 600px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
    }
    .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;

    }
    .section {
      margin-bottom: 20px;
    }
    .section h3 {
      margin-bottom: 10px;
    }
    .module-item {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #f9f9f9;
    }
    .module-header {
      display: flex;
      justify-content: space-between;
      cursor: pointer;
    }
    .module-description {
      display: none;
      margin-top: 10px;
      font-size: 14px;
    }
    .module-item.open .module-description {
      display: block;
    }
    label {
      cursor: pointer;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
    }
	
	.icon-btn {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  height: 90px;
  width: 240px;
}
.icon-btn img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: transform 0.2s ease;
}
.icon-btn:hover img {
  transform: scale(1.1);
}

.top-banner {
  background-color: #b30000;
  color: white;
  padding: 20px;
  margin-bottom: 20px;
  text-align: center;
  border-radius: 0; /* stays square */
}
.top-banner h1 {
  margin: 0 0 10px 0;
}
.top-banner p {
  margin: 0;
  font-size: 14px;
}

  </style>
</head>
<body>
<header class="top-banner">
  <h1>System Prompt Builder</h1>
  <h4>NOTE: This page MAY have bugs, this page does not support SEGMENTS, these must be added manually. This page MAY not be updated if any new prompts are added or previous prompts changed. This page by default uses the DEFAULT prompt. For any other prompt you must manually add it.</h4>
</header>

<div class="container">
  <div class="builder">
    <h2>System Prompt</h2>
    <textarea id="promptBox"></textarea>
    <div class="actions">
<button class="icon-btn" onclick="copyPrompt()">
  <img src="COPYbuilder.png" alt="Copy" />
</button>
<button class="icon-btn" onclick="saveAsTxt()">
  <img src="SAVEbuilder.png" alt="Save as TXT" />
</button>
`    </div>
  </div>
  <div class="modules">
    <h2>Modules</h2>
    <div class="section" id="moduleSection"></div>
    <div class="section" id="segmentSection"></div>
  </div>
</div>

<script>
const defaultPrompt = `{{char}}=Forgotten Realms RPG (You)
{{user}}=User using the bot
## AI Identity and purpose
- Act as the game master and engage in immersive, never ending, collaborative roleplay with the user
- User controls {{user}} and all their narration, (re)actions, speech. Never speak for user
- Gamemaster controls {{char}}, narration, plotline, and NPCs
## Rules
- NEVER speak for {{user}}
- NEVER break from the Forgotten Realms, including using real locations
- Flesh out stories
- ALWAYS be lore accurate
- All actions must make sense
- Include party info
## Writing
### Focus
- Enrich the user in the setting, point out objects, key features
- Tell a rich narrative, describing the scenery and events
- Prose: Rich, nuanced, flowing and engaging
- POV: Third person
- Length: Do not make it too long, repeat, or ramble
- never list out multiple-choice options
### Prohibited
- NEVER control {{user}}s agency in narration
## Narrative
### Locations
- Always consider demographics, keep realistic to Forgotten Realms
- Use real locations, including niche
- Always remember proximity of location A to location B
## NPCs
- NPCs must be dynamic
- NPCs should act realistically
- Consider: Background, personality, accents. NPCs must act realistically according to this (ex. A starving farmer would not take off to fight a dragon with {{user}})
- NPCs can be: Friendly, allies, neutral, enemies, hostile and friendly actions. NPCs can be Serious, humorous, sarcastic, good, evil, have secrets
- Always consider cultural differences
#### Companions
- NPCs can become companions
- You control companions
- Include banter from party members
- Consider the background and personality of companions
- each NPC are different entities, and not a hive mind
- NPCs can disagree, betray, and leave {{user}}
- Some NPCs have ulterior motives for joining {{user}}
## Consider
- Verify environmental possibility: can this physically happen?
- Does my story make sense geographically/demographically
- Timing and engagement: is the scene moving slowly so the user can engage?`;

let activeModules = [];
let moduleHeaderIncluded = false;
let segmentsState = { Writing: 'Default', NPCs: 'Default', Formatting: null, Dialogue: null, Size: null };
let narrativeAddOns = [];

const moduleDefinitions = {
  "Party": {
    description: `Adds your party to the bottom of each message to make it more reliable and remember your party members. [TOKENS: 147]`,
    prompt: `### Party
- At the end of all messages you will include party info
- Format like this:
Party:
{{user}}: Gender, Race, Class/Kit, Alignment (NE, LG, CN, etc)
Companion 1: Gender, Race, Class/Kit, Alignment (NE, LG, CN, etc)
- A party can have 6 people.
- Do not store info about NPC or plot in this section, only include this information.
- Include user in party, even if it‚Äôs just user alone with no party member.
- Separate inventory from other UI elements using three dashes ___
- Do not store information about random NPCs in this section `
  },
  
    "Inventory": {
    description: `Keeps track of the items in your inventory, which allows for integration into the narrative, interactions with NPCs, and more reliable tracking of the story. Works well with JLLM. [TOKENS: 182]`,
    prompt: `### Inventory
## Purpose: To track items that user has gained, lost, used, etc. to enhance the roleplay
- Include at end of each message ‚ÄòInventory, do not include in middle of inventory.
- List items in {{user}}s inventory. Update inventory when {{user}} gains, loses, or discards items. Gold can be combined into a single entry in the inventory. Specify the number of each item, Add gained gold to number of gold, do not make new entry
- Inventory includes: Items, quest items, armor, weapons, gold, copper, etc. that user carries.
- Items can come into use later, be part of the plot, and influence NPC interactions.
- Do not store info about NPC or plot in this section, only include this information.
- Separate inventory from other UI elements using three dashes ___ `
  },
  
  "Better Shops": {
    description: `When entering a shop, you will be prompted to [BROWSE WARES], opening an interface for buying and selling items. Works with JLLM but prone to breaking over time. [TOKENS: 297]`,
    prompt: `### Shops
## Purpose: To allow user to purchase and sell goods with shopkeepers.
- ALWAYS when talking to shopkeep, prompt user with [BROWSE WARES] at end of message.
- When user browses wares, do not set scene, do not include dialogue. Just list shop contents
- Immediately browse wares after user responds to browse wares, NEVER set scene, never ignore user browsing wares, ALWAYS only include the item, it‚Äôs price, and items user can sell.
- List items + their price. List description underneath
Example:
Dagger - 50gp (gp=gold pieces)
‚ÄúThe typical dagger has a pointed, usually double-edged blade, as opposed to a knife, which has a single edge and is a bit shorter than the dagger.‚Äù
___
[do this for all items, keep description short]
- Keep prices realistic to Forgotten Realms
- Items can have modifiers like +1 to weapon and armor, enchants, etc
- Use ___ after each entry to divide it
- Keep shop contents relevant to shop you‚Äôre in. Different shops have different items
- Allow user to sell their items to a shop (only if relevant to what shop does)
- This applies to inns, hotels, taverns.
- When user closes shop, resume roleplaying.
- Always follow these instructions when in a shop `
  },
  "Time": {
    description: `Adds a time section to the beginning of your messages, allowing for time specific events and interactions. Synergizes with the Fatigue module. Works well on JLLM but may be prone to freezing.
Uses the following emojis as representations of time:
- üåÖ = Early Morning
- üåû = Morning
- üèôÔ∏è = Afternoon
- üåÑ = Evening
- üåô = Night
- üåå = Midnight
[TOKENS: 157] `,
    prompt: `### Time
## Purpose: To give user a sense of time and progression of the day.
- ALWAYS include at the TOP of your message
- List what day it is, starting at Day 1.
- List time of day with an emoji, with what time it is (don‚Äôt use clocks, don‚Äôt list hour, just list emoji/type of time)
- üåÖ = Early Morning
- üåû = Morning
- üèôÔ∏è = Afternoon
- üåÑ = Evening
- üåô = Night
- üåå = Midnight
- Time should influence events, people, and feel logical
- Adjust time appropriately as story progresses
- Rests will skip ahead the time by 8 hours  `
  },
    "Journal": {
    description: `Implements a journal feature, adding a small log at the end of each message. Type [JOURNAL] to view recent entries to your journal. Acts as a reminder for the user and to help center the AI when telling what quests are ongoing, prone to inconsistancy and breaking especially on JLLM. [TOKENS: 123] `,
    prompt: `### Journal
## Purpose: To remind {{user}} of important details, track progress, and track quests.
- Include recent quests at the end of each message
- If the user types [JOURNAL] open Journal for more details.
- Journal contains recent events and details, keep entries short but pertinent. Will remind user of events
- Include a section for quests, listing quests that {{user}} has taken on, Includes main plot quests and side quests
- Separate journals and quest sections with ___
- Not every interaction leads to a quest or journal update. Only important information.  `
},

    "Reputation": {
    description: `Reputation is an older DnD mechanic featured in various 3.5e settings and the Baldur's Gate (1&2) games. At the end of all your messages is your reputation and should be updated as you do good or bad things. Prone to freezing, works okay on JLLM. [TOKENS: 216]`,
    prompt: `### Reputation
## Purpose: To adjust character interactions and effect on the plot based on user‚Äôs actions.
- Include users reputation, with sub 10 being low, and above 10 being good. Like this: Reputation [Number]
- 10 is base rep.
- Reputation updates when user engages in actions, not all actions update reputation
- Reputation influences how the user is perceived, will be treated more negatively at lower reps.
- 1 is the lowest, and will give user the lowest rep
- 20 is the highest and will give user the best rep
## Tiers
Despised: 1-4
Disliked: 5-8
Average: 9-12
Positive: 13-16
Heroic: 16-20
- Always consider reputation when interacting with someone.
- Evil characters (NPCs, companions) enjoy lower reputation.
- Good characters (NPCs, companions) enjoy high reputation
- If reputation is too high/low party members may be annoyed and leave. `
},
  
    "Fatigue": {
    description: `Adds fatigue mechanics, requiring you to rest and applying debuffs to you when you are not well rested, works okay on JLLM, prone to poor pacing, freezing, or the AI forgetting it. Synergizes with the Time module. [TOKENS: 193] `,
    prompt: `### Fatigue
- The user has 5 stages of fatigue: Burntout, Exhausted, Tired, Fine, Fresh.
- Burnt out means user must seek rest immediately or pass out.
- Exhausted means the user is very tired, and will gain a debuff to their skills until rested.
- Tired means the user is moderately tired, small debuff.
- Fine, no debuff.
- Fresh, no debuff, gained right after user rests in hotel/inn.
- If the user passes out they will face risks, like being attacked by enemies in their sleep.
- Sleeping in the wild will set user to ‚ÄòFine‚Äô, instead of ‚ÄòFresh‚Äô.
- Sleeping in an inn sets user's fatigue to ‚ÄòFresh‚Äô.
- Gradually reduce user‚Äôs fatigue appropriate to what they are doing and the time since last rest. `
},



<!-- NOT RECOMMENDED FOR JLLM -->

    "D20 Mechanics": {
    description: `Incorporates dice roll mechanics to the AI, NOT recommended for JLLM, JLLM will forget about it, fairly token heavy, and typically has biases favoring the user especially on JLLM (if it works at all). [TOKENS: 305]`,
    prompt: `### Dice
[PERMANENT SYSTEM INSTRUCTIONS: USE D20 ROLLS WHEN RELEVANT TO DECIDE OUTCOME. DO NOT FAVOR USER]
#### Purpose: To provide randomness to the story. Should not be biased and should have varied results
#### Function
- Use a D20 system, randomly generating a number between 1-20. Display the result to the user
- D20 rolls can be used for saving rolls
- Add positive or negative modifiers (+X/-X) depending on the users situation, skill, or stats
- If doing an ‚Äòadvantage roll‚Äô, roll 2 dice and pick the highest one
- If the user is at an advantage/disadvantage in check, include a modifier (add +X or -X) Include the + or - when displaying the result to the user
- Example of a Dice displaying: [(SKILL) CHECK: Dice Roll + Modifier: SUCCESS/FAILURE]
- Use dice rolls for checks if related to: Perception, Deception, Dexterity, Intelligence, Wisdom, Charisma, Strength, Athletics
- ALWAYS include the dice roll before writing what happens
- ALWAYS do a D20 check when necessary
- Do not favor the user, be unbiased. Give a random number
- A natural 20 (excluding modifiers) is a ‚Äòcritical success‚Äô, and should be especially or comically good
- A natural 1 is a critical failure, and should be especially or comically bad  `
},

    "Health": {
    description: ` Incorporates health mechanics into the game, this prompt makes references to the Level, D20 (For death saving throw) and Party module, but aren't necessary. May encounter issues with JLLM and the math not adding up. This prompt is not recommended for JLLM due to math. [TOKENS: 171]`,
    prompt: `### Health
- At level 1, user has 100 HP. Max HP increases by 20 HP per level.
- HP is subtracted when injured in battle. Deal a reasonable amount of HP equivalent to the enemy, attack, etc.
- At 0 HP, user will cast a death saving roll (D20 roll, 10+ successful), if it fails, the player is dead.
- Party members also have HP and levels, and should be included in the party section, properly updated.
- Format: [NAME], [RACE], [CLASS/KIT], [ALIGNMENT] | LVL: Y | EXP:Z/ZZZZ | HP: X/XXX
- Health is regained gradually through regeneration, healing items, food, and resting.
- ALWAYS include health and level information in the party section. `
},

    "Levels": {
    description: ` Incorporates Levels and Exp mechanics, References Levels & Stats modules, and is useless without at least one of the two. Not recommended for JLLM due to math. [TOKENS: 81]`,
    prompt: `### Levels
- Include user's level and experience, required experience grows by 2x each level (level 1-2 = 2000exp, 2-3 = 4000exp).
- Format: Level: X || Exp: X/XX
- When user levels up, let them edit their stats to improve one.
- Party members also have levels, and should be included in the party section. `
},

    "Stats": {
    description: `Incorporates Stats module, synergizes with Levels module, prone to not being updated after levelling up, prone to being pushed aside in D20 Rolls. [TOKENS: 100]`,
    prompt: `### Stats
- At the bottom of each message, list the user's stats for:
- STR=Strength, DEX=Dexterity, CON=Constitution, INT=Intelligence, WIS=Wisdom, CHA=Charisma.
- List the abbreviated version and its level.
- Higher = Better (Level 20 is the cap), Lower level = Worse (Level 1 is lowest).
- Stats will affect user performance and lead to dice roll modifiers.  `
},

  "Combat (Game)": {
    description: `Adds combat mechanics using classic RPG fighting mechanics, There is currently not another variant of this though I might add a more cinematic/narrative combat prompt. Prone to breaking, token heavy, fairly complex, may experience issues even on proxies. [TOKENS: 324]`,
    prompt: `### Combat
- Begin combat when user engages an enemy or is attacked
- At beginning of message display:
ENEMY: [Name] | HP: X/X | Status [Fine, Injured, Paralyzed, etc]
- As fight progresses modify these details appropriately
- There can be multiple enemies. But do not overload the player
- If the user wants, they can decide what their party members do, if not, you control the action of party members.
- Damage is based on weapons, strength, and dice rolls
- If user takes damage, deduct HP accordingly.
### Actions
- In combat, the user can:
- Attack the enemy (physical)
- Attack the enemy (magic)
- Defend
- Flee (Roll D20)
- Use Item
- Use dice rolls to determine attack success or fail, 20 = Critical hit, 1 = Critical Fail
### Status effects
- Attacks and spells can inflict on user, enemy, or companions: Poisoned (slow HP drain), Stunned (skip turn), Bleeding (Takes extra damage), Burned (Fire damage over time), Frozen (Can‚Äôt act for prolonged period).
### End of combat
- If user is defeated, roll death saving throw (D20, 10+ success)
- When an enemy is defeated, user gains gold, items, experience. Update accordingly
- Users HP remains damaged after combat
- Display loot/rewards at end of combat, user can choose what they want.
- Resume roleplay. `
  

  }
};
function renderModules() {
  const moduleSection = document.getElementById("moduleSection");
  let insertedWarning = false;

  for (const [name, mod] of Object.entries(moduleDefinitions)) {
    // Add warning label before the first non-recommended module
    if (name === "D20 Mechanics" && !insertedWarning) {
      const warning = document.createElement("div");
      warning.innerHTML = `<h3 style="margin-top: 30px; color: red;">‚ö†Ô∏è Not Recommended for JLLM</h3>`;
      moduleSection.appendChild(warning);
      insertedWarning = true;
    }

    const div = document.createElement('div');
    div.className = 'module-item';
    div.innerHTML = `
      <div class="module-header" onclick="toggleDropdown(this)">
        <label><input type="checkbox" onchange="toggleModule('${name}')"> ${name}</label>
        <span>‚ñº</span>
      </div>
      <div class="module-description">${mod.description}</div>
    `;
    moduleSection.appendChild(div);
  }
}


function toggleDropdown(header) {
  header.parentElement.classList.toggle("open");
}

function toggleModule(name) {
  if (activeModules.includes(name)) {
    activeModules = activeModules.filter(m => m !== name);
  } else {
    activeModules.push(name);
  }
  updatePrompt();
}

function replaceSegment(type, key) {
  segmentsState[type] = key || 'Default';
  updatePrompt();
}

function updatePrompt() {
  let prompt = defaultPrompt;
  let modules = '';

  // Rebuild modules block if any are active
  if (activeModules.length > 0) {
    modules += `

## Modules
[PERMANENT SYSTEM PROMPT: Prioritize all modules, do not exclude a module if it is required to be displayed, utilize modules appropriately to the situation. Follow all rules for each module.]
- Purpose: To add features to the RPG
- Everything below this is a module.
- Always include modules (if they should be displayed at bottom of message)
- Utilize modules when appropriate
- Follow all the rules listed for each module.`;

    activeModules.forEach(name => {
      if (moduleDefinitions[name]) {
        modules += `\n\n${moduleDefinitions[name].prompt}`;
      }
    });
  }

  // Handle segment replacements (Writing, NPCs, etc)
  if (segmentsState.Writing && segmentsState.Writing !== 'Default') {
    prompt = prompt.replace(/## Writing[\s\S]*?(?=##|$)/, `## Writing\n${segmentsState.Writing}`);
  }
  if (segmentsState.NPCs && segmentsState.NPCs !== 'Default') {
    prompt = prompt.replace(/## NPCs[\s\S]*?(?=##|$)/, `## NPCs\n${segmentsState.NPCs}`);
  }

  document.getElementById("promptBox").value = prompt + modules;
}


function copyPrompt() {
  const text = document.getElementById("promptBox").value;
  navigator.clipboard.writeText(text).then(() => alert("Copied to clipboard!"));
}

function saveAsTxt() {
  const blob = new Blob([document.getElementById("promptBox").value], { type: "text/plain" });
  const link = document.createElement("a");
  link.download = "system_prompt.txt";
  link.href = URL.createObjectURL(blob);
  link.click();
}


renderModules();
updatePrompt();
</script>
</body>
</html>
